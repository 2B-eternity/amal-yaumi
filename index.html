<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amal Yaumi - Pelacak Ibadah Harian</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            overflow-x: hidden;
        }
        .font-amiri { font-family: 'Amiri', serif; }
        .custom-checkbox:checked + label div { background-color: #10b981; border-color: #10b981; }
        .custom-checkbox:checked + label div svg { display: block; }
        .custom-checkbox:checked + label span { text-decoration: line-through; color: #9ca3af; } /* gray-400 */
        #sidebar { transition: transform 0.3s ease-in-out; }
        .sidebar-open { transform: translateX(0) !important; }
        #overlay { transition: opacity 0.3s ease-in-out; }
        
        /* Cube Chart Styles */
        .chart-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 1.5rem; align-items: flex-end; padding: 1rem; min-height: 200px; }
        .cube-wrapper { display: flex; flex-direction: column; align-items: center; width: 60px;}
        .cube { width: 40px; position: relative; transform-style: preserve-3d; transition: height 0.5s ease-in-out; }
        .cube-face { position: absolute; width: 40px; }
        .cube-face.front { height: 100%; transform: translateZ(20px); }
        .cube-face.top { height: 40px; top: 0; transform: rotateX(90deg) translateZ(20px); }
        .cube-face.side { height: 100%; left: -20px; transform: rotateY(-90deg) translateZ(20px); }
        .cube-label { margin-top: 0.5rem; font-size: 0.75rem; font-weight: 500; text-align: center; }
        .cube-percentage { font-size: 0.8rem; font-weight: 700; margin-bottom: 0.25rem; }

        /* Welcome Page Animation */
        .fade-in { animation: fadeIn 1s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Confirmation Modal */
        #confirmation-modal { transition: opacity 0.2s ease-in-out; }
        
        /* Islamic Frame for Welcome Title */
        .islamic-frame {
            position: relative;
            padding: 2.5rem 1rem;
            display: inline-block;
            width: 100%;
            max-width: 550px;
        }
        .islamic-frame svg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1.6, 1.2);
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        .frame-content {
            position: relative;
            z-index: 1;
        }

        /* Calendar Styles */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
        .calendar-day { display: flex; align-items: center; justify-content: center; height: 40px; position: relative; }
        .calendar-day.completed .check-icon { display: block; }
        .check-icon { display: none; position: absolute; top: 2px; right: 2px; }

        /* Achievement Styles */
        .achievement-card.unlocked {
            filter: none;
            opacity: 1;
        }
        .achievement-card.locked {
            filter: grayscale(100%);
            opacity: 0.6;
        }
        .achievement-card.unlocked .achievement-icon {
            background-color: #fcd34d; /* amber-300 */
            color: #b45309; /* amber-700 */
        }
    </style>
</head>
<body class="bg-emerald-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <!-- Welcome View -->
    <div id="welcome-view" class="fixed inset-0 bg-emerald-50 dark:bg-gray-900 z-50 flex items-center justify-center p-4 fade-in">
        <div class="text-center max-w-lg flex flex-col items-center">
            
            <div class="islamic-frame my-8">
                 <svg viewBox="0 0 100 100" class="text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" stroke-width="0.5">
                    <path d="M50 2 L61.8 15.2 L78.5 15.2 L84.8 29 L98 38.2 L98 61.8 L84.8 71 L78.5 84.8 L61.8 84.8 L50 98 L38.2 84.8 L21.5 84.8 L15.2 71 L2 61.8 L2 38.2 L15.2 29 L21.5 15.2 L38.2 15.2 Z"/>
                 </svg>
                 <div class="frame-content">
                    <h1 class="text-5xl md:text-6xl font-amiri font-bold text-emerald-800 dark:text-emerald-300">AMAL YAUMI</h1>
                    <p class="mt-4 text-base text-gray-600 dark:text-gray-300 px-4">Catat dan tingkatkan ibadah harian Anda. Jadikan setiap hari lebih bermakna dan istiqomah dalam kebaikan.</p>
                 </div>
            </div>

            <button id="enter-app-btn" class="bg-emerald-600 text-white font-bold py-3 px-6 rounded-full hover:bg-emerald-700 transition-transform transform hover:scale-105 shadow-lg">Mulai</button>
        </div>
    </div>
    
    <!-- App Container -->
    <div id="app-container" class="hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="fixed top-0 left-0 w-64 h-full bg-white dark:bg-gray-800 shadow-xl z-30 transform -translate-x-full overflow-y-auto">
            <div class="p-4 border-b border-stone-200 dark:border-gray-700 flex justify-between items-center sticky top-0 bg-white dark:bg-gray-800">
                <h2 class="text-xl font-bold text-emerald-600 dark:text-emerald-400">Menu</h2>
                <button id="close-sidebar" class="p-1 rounded-full hover:bg-stone-200 dark:hover:bg-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <div class="p-4">
                <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Navigasi</h3>
                 <button id="monthly-activity-btn" class="w-full flex items-center text-left text-sm py-2 px-3 rounded-lg hover:bg-emerald-100 dark:hover:bg-gray-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                    Aktivitas Bulanan
                </button>
                 <button id="monthly-chart-menu-btn" class="w-full flex items-center text-left text-sm py-2 px-3 rounded-lg hover:bg-emerald-100 dark:hover:bg-gray-700 transition-colors mt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" /></svg>
                    Grafik Bulanan
                </button>
                 <button id="achievement-menu-btn" class="w-full flex items-center text-left text-sm py-2 px-3 rounded-lg hover:bg-emerald-100 dark:hover:bg-gray-700 transition-colors mt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 20.944A12.02 12.02 0 0012 21a12.02 12.02 0 009-10.056c0-1.307-.21-2.57-.618-3.784z" /></svg>
                    Achievement
                </button>
                <button id="leaderboard-menu-btn" class="w-full flex items-center text-left text-sm py-2 px-3 rounded-lg hover:bg-emerald-100 dark:hover:bg-gray-700 transition-colors mt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                    Leaderboard
                </button>
            </div>
            <div class="p-4 border-t border-stone-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Riwayat Harian</h3>
                <ul id="history-list" class="space-y-1 max-h-64 overflow-y-auto"></ul>
            </div>
             <div class="p-4 border-t border-stone-200 dark:border-gray-700 space-y-2">
                 <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Pengaturan</h3>
                <button id="delete-day-btn" class="w-full flex items-center justify-center text-sm bg-red-500 text-white font-semibold py-2 px-3 rounded-lg hover:bg-red-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    Hapus Data Hari Ini
                </button>
                 <button id="back-to-welcome-btn" class="w-full flex items-center justify-center text-sm bg-gray-500 text-white font-semibold py-2 px-3 rounded-lg hover:bg-gray-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h12" /></svg>
                    Kembali ke Awal
                </button>
            </div>
        </div>
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

        <!-- Main Content -->
        <div class="max-w-lg mx-auto p-4 sm:p-6 min-h-screen">
            <!-- Dashboard View -->
            <div id="dashboard-view">
                <header class="flex items-center justify-between mb-6">
                    <button id="open-sidebar" class="p-2 rounded-full hover:bg-emerald-100/70 dark:hover:bg-gray-800/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
                    <div class="text-center flex-grow">
                        <h1 class="text-4xl font-amiri font-bold text-emerald-800 dark:text-emerald-400">Amal Yaumi</h1>
                        <div class="flex items-center justify-center mt-2 space-x-4">
                            <button id="prev-day-btn" class="p-2 rounded-full hover:bg-emerald-200/50 dark:hover:bg-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                            </button>
                            <div class="text-center">
                                <p id="day-name-display" class="font-semibold text-emerald-700 dark:text-emerald-300"></p>
                                <p id="date-display" class="text-sm text-gray-600 dark:text-gray-400"></p>
                            </div>
                            <button id="next-day-btn" class="p-2 rounded-full hover:bg-emerald-200/50 dark:hover:bg-gray-700">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                            </button>
                        </div>
                    </div>
                    <div class="w-8 sm:w-10"></div>
                </header>
                <div id="main-view">
                    <div class="flex flex-col items-center justify-center mb-8 p-6 bg-white dark:bg-gray-800/70 rounded-xl shadow-lg">
                        <span id="score-text" class="text-5xl font-bold text-emerald-600 dark:text-emerald-400">0</span>
                        <span class="text-lg font-medium text-gray-700 dark:text-gray-300 mt-1">Poin Istiqomah</span>
                    </div>
                    <div class="space-y-6 bg-white dark:bg-gray-800/70 p-6 rounded-xl shadow-lg">
                        <div><h2 class="text-xl font-semibold mb-3 pb-2 border-b-2 border-emerald-100 dark:border-gray-700">Ibadah Wajib (50 Poin)</h2><div id="wajib-list" class="space-y-3"></div></div>
                        <div class="mt-6"><h2 class="text-xl font-semibold mb-3 pb-2 border-b-2 border-emerald-100 dark:border-gray-700">Ibadah Sunnah (30 Poin)</h2><div id="sunnah-list" class="space-y-3"></div></div>
                    </div>
                    <button id="submit-btn" class="w-full mt-8 bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-emerald-700 transition-colors shadow-lg">Submit Amalan Hari Ini</button>
                </div>
                <div id="submitted-view" class="hidden text-center">
                    <div id="feedback-panel" class="p-6 rounded-xl transition-colors duration-500 shadow-lg"></div>
                    <div class="mt-8 p-6 bg-white dark:bg-gray-800/70 rounded-lg shadow-lg">
                        <h3 class="font-semibold text-lg mb-2">Kata Pak Ustad</h3>
                        <blockquote id="quote-container" class="italic"></blockquote>
                    </div>
                    <div id="monthly-activity" class="mt-8 text-left"></div>
                    <button id="back-to-checklist-btn" class="w-full mt-8 bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors shadow-lg">Lihat/Ubah Checklist</button>
                </div>
            </div>

            <!-- Calendar View -->
            <div id="calendar-view" class="hidden">
                 <header class="flex items-center justify-between mb-6">
                    <button id="back-to-dashboard-btn" class="p-2 rounded-full hover:bg-emerald-100/70 dark:hover:bg-gray-800/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg></button>
                    <h2 class="text-2xl font-bold text-emerald-800 dark:text-emerald-400">Aktivitas Bulanan</h2>
                    <div class="w-8 sm:w-10"></div>
                </header>
                <div class="p-4 bg-white dark:bg-gray-800/70 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                         <button id="prev-month-btn" class="p-2 rounded-full hover:bg-emerald-200/50 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                        </button>
                        <h3 id="month-year-display" class="text-lg font-semibold"></h3>
                         <button id="next-month-btn" class="p-2 rounded-full hover:bg-emerald-200/50 dark:hover:bg-gray-700">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                        </button>
                    </div>
                    <div class="calendar-grid font-semibold text-sm text-center text-gray-500">
                        <div>Min</div><div>Sen</div><div>Sel</div><div>Rab</div><div>Kam</div><div>Jum</div><div>Sab</div>
                    </div>
                    <div id="calendar-body" class="calendar-grid mt-2"></div>
                </div>
            </div>
            
             <!-- Chart View -->
            <div id="chart-view" class="hidden">
                 <header class="flex items-center justify-between mb-6">
                    <button id="back-to-dashboard-from-chart-btn" class="p-2 rounded-full hover:bg-emerald-100/70 dark:hover:bg-gray-800/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg></button>
                    <h2 class="text-2xl font-bold text-emerald-800 dark:text-emerald-400">Grafik Bulanan</h2>
                    <div class="w-8 sm:w-10"></div>
                </header>
                <div class="p-4 bg-white dark:bg-gray-800/70 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                         <button id="prev-month-chart-btn" class="p-2 rounded-full hover:bg-emerald-200/50 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                        </button>
                        <h3 id="month-year-chart-display" class="text-lg font-semibold"></h3>
                         <button id="next-month-chart-btn" class="p-2 rounded-full hover:bg-emerald-200/50 dark:hover:bg-gray-700">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                        </button>
                    </div>
                    <div id="monthly-chart-standalone-container" class="mt-4"></div>
                </div>
            </div>

            <!-- Achievement View -->
            <div id="achievement-view" class="hidden">
                 <header class="flex items-center justify-between mb-6">
                    <button id="back-to-dashboard-from-achievement-btn" class="p-2 rounded-full hover:bg-emerald-100/70 dark:hover:bg-gray-800/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg></button>
                    <h2 class="text-2xl font-bold text-emerald-800 dark:text-emerald-400">Achievements</h2>
                    <div class="w-8 sm:w-10"></div>
                </header>
                <div id="achievement-list" class="space-y-4">
                    <!-- Achievements will be populated by JS -->
                </div>
            </div>
            
            <!-- Leaderboard View -->
            <div id="leaderboard-view" class="hidden">
                 <header class="flex items-center justify-between mb-6">
                    <button id="back-to-dashboard-from-leaderboard-btn" class="p-2 rounded-full hover:bg-emerald-100/70 dark:hover:bg-gray-800/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg></button>
                    <h2 class="text-2xl font-bold text-emerald-800 dark:text-emerald-400">Leaderboard</h2>
                    <div class="w-8 sm:w-10"></div>
                </header>
                <div class="p-4 bg-white dark:bg-gray-800/70 rounded-xl shadow-lg">
                    <ul id="leaderboard-list" class="space-y-2">
                        <!-- Leaderboard will be populated by JS -->
                    </ul>
                </div>
            </div>


            <footer class="text-center mt-10 text-xs text-emerald-900 dark:text-emerald-200">
                <p>&copy; 2025 FSI Al-fatih</p>
            </footer>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-60 z-40 flex items-center justify-center p-4 hidden opacity-0">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
            <h3 class="text-lg font-bold">Anda Yakin?</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300 my-2">Tindakan ini akan menghapus data amalan pada tanggal yang dipilih. Data tidak dapat dikembalikan.</p>
            <div class="mt-4 flex justify-center space-x-3">
                <button id="cancel-delete-btn" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500">Batal</button>
                <button id="confirm-delete-btn" class="px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600">Ya, Hapus</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- KONFIGURASI ---
            const WAJIB_POINTS = 50;
            const SUNNAH_POINTS = 30;
            const amalan = {
                wajib: [{ id: 'subuh', text: 'Sholat Subuh', points: WAJIB_POINTS },{ id: 'dzuhur', text: 'Sholat Dzuhur', points: WAJIB_POINTS },{ id: 'ashar', text: 'Sholat Ashar', points: WAJIB_POINTS },{ id: 'maghrib', text: 'Sholat Maghrib', points: WAJIB_POINTS },{ id: 'isya', text: 'Sholat Isya', points: WAJIB_POINTS },],
                sunnah: [{ id: 'tahajud', text: 'Sholat Tahajud', points: SUNNAH_POINTS },{ id: 'dhuha', text: 'Sholat Dhuha', points: SUNNAH_POINTS },{ id: 'tilawah', text: 'Tilawah Qur\'an', points: SUNNAH_POINTS },{ id: 'murajaah', text: 'Murajaah', points: SUNNAH_POINTS },{ id: 'dzikir_pagi', text: 'Dzikir Pagi', points: SUNNAH_POINTS },{ id: 'dzikir_petang', 'text': 'Dzikir Petang', points: SUNNAH_POINTS },{ id: 'sedekah', text: 'Sedekah', points: SUNNAH_POINTS },{ id: 'puasa_sunnah', text: 'Puasa Sunnah', points: SUNNAH_POINTS },]
            };
            const mockUsers = [
                { name: 'Abdullah', score: 125500 }, { name: 'Fatimah', score: 112000 },
                { name: 'Ahmad', score: 100000 }, { name: 'Zainab', score: 85000 },
            ];
            const achievements = [
                { id: 'dermawan', amalId: 'sedekah', threshold: 7, title: 'Sang Dermawan', description: 'Bersedekah lebih dari 7 hari.', type: 'count' },
                { id: 'nabi_suka', amalId: 'tahajud', threshold: 30, title: 'Yang Nabi Suka', description: 'Sholat Tahajud lebih dari 30 hari.', type: 'count' },
                { id: 'sahabat_quran', amalId: 'tilawah', threshold: 30, title: 'Al-Qur\'an is My Bestfriend', description: 'Membaca Al-Qur\'an lebih dari 30 hari.', type: 'count' },
                { id: 'langkah_hijrah', target: 'Zainab', threshold: 85000, title: 'Langkah Hijrah', description: 'Berhasil mengalahkan Zainab.', type: 'score' },
                { id: 'goes_to_better', target: 'Ahmad', threshold: 100000, title: 'Goes to be Better', description: 'Berhasil mengalahkan Ahmad.', type: 'score' },
                { id: 'puncak_takwa', target: 'Fatimah', threshold: 112000, title: 'Menuju Puncak Takwa', description: 'Berhasil mengalahkan Fatimah.', type: 'score' },
                { id: 'the_king', target: 'Abdullah', threshold: 125500, title: 'I am The King 😎', description: 'Berhasil mengalahkan Abdullah.', type: 'score' },
            ];
            const allAmalMap = new Map([...amalan.wajib, ...amalan.sunnah].map(item => [item.id, item]));
            const quotes = [ "Amalan yang paling dicintai oleh Allah adalah amalan yang kontinu walaupun itu sedikit.", "Sesungguhnya sholatku, ibadahku, hidupku dan matiku hanyalah untuk Allah, Tuhan semesta alam.", "Maka sesungguhnya beserta kesulitan ada kemudahan, sesungguhnya beserta kesulitan itu ada kemudahan.", "Jangan berduka, sesungguhnya Allah bersama kita.", "Ilmu tanpa amal adalah kegilaan, dan amal tanpa ilmu adalah kesia-siaan.", "Sabar itu ada dua macam: sabar atas sesuatu yang tidak kau ingin dan sabar menahan diri dari sesuatu yang kau ingini.", "Dunia ini ibarat bayangan. Kalau kau berusaha menangkapnya, ia akan lari. Tapi kalau kau membelakanginya, ia tak punya pilihan selain mengikutimu.", "Barangsiapa yang menempuh suatu jalan untuk menuntut ilmu, maka Allah akan memudahkan baginya jalan menuju surga.", "Jangan sekali-kali meremehkan kebaikan sedikit pun, meskipun hanya dengan bertemu dengan saudaramu dengan wajah yang tersenyum." ];

            // --- ELEMEN DOM ---
            const welcomeView = document.getElementById('welcome-view'), appContainer = document.getElementById('app-container'),
                  enterAppBtn = document.getElementById('enter-app-btn'), mainView = document.getElementById('main-view'), 
                  submittedView = document.getElementById('submitted-view'), wajibList = document.getElementById('wajib-list'), 
                  sunnahList = document.getElementById('sunnah-list'), scoreText = document.getElementById('score-text'), 
                  sidebar = document.getElementById('sidebar'), overlay = document.getElementById('overlay'), 
                  openSidebarBtn = document.getElementById('open-sidebar'), closeSidebarBtn = document.getElementById('close-sidebar'), 
                  historyList = document.getElementById('history-list'), submitBtn = document.getElementById('submit-btn'), 
                  backToBtn = document.getElementById('back-to-checklist-btn'), quoteContainer = document.getElementById('quote-container'), 
                  monthlyActivityContainer = document.getElementById('monthly-activity'), feedbackPanel = document.getElementById('feedback-panel'), 
                  deleteDayBtn = document.getElementById('delete-day-btn'), confirmationModal = document.getElementById('confirmation-modal'),
                  cancelDeleteBtn = document.getElementById('cancel-delete-btn'), confirmDeleteBtn = document.getElementById('confirm-delete-btn'),
                  prevDayBtn = document.getElementById('prev-day-btn'), nextDayBtn = document.getElementById('next-day-btn'),
                  dayNameDisplay = document.getElementById('day-name-display'), dateDisplay = document.getElementById('date-display'),
                  backToWelcomeBtn = document.getElementById('back-to-welcome-btn'),
                  dashboardView = document.getElementById('dashboard-view'), calendarView = document.getElementById('calendar-view'),
                  monthlyActivityBtn = document.getElementById('monthly-activity-btn'),
                  backToDashboardBtn = document.getElementById('back-to-dashboard-btn'),
                  monthYearDisplay = document.getElementById('month-year-display'),
                  calendarBody = document.getElementById('calendar-body'),
                  prevMonthBtn = document.getElementById('prev-month-btn'),
                  nextMonthBtn = document.getElementById('next-month-btn'),
                  chartView = document.getElementById('chart-view'),
                  monthlyChartMenuBtn = document.getElementById('monthly-chart-menu-btn'),
                  backToDashboardFromChartBtn = document.getElementById('back-to-dashboard-from-chart-btn'),
                  monthYearChartDisplay = document.getElementById('month-year-chart-display'),
                  monthlyChartStandaloneContainer = document.getElementById('monthly-chart-standalone-container'),
                  prevMonthChartBtn = document.getElementById('prev-month-chart-btn'),
                  nextMonthChartBtn = document.getElementById('next-month-chart-btn'),
                  achievementView = document.getElementById('achievement-view'),
                  achievementMenuBtn = document.getElementById('achievement-menu-btn'),
                  backToDashboardFromAchievementBtn = document.getElementById('back-to-dashboard-from-achievement-btn'),
                  achievementList = document.getElementById('achievement-list'),
                  leaderboardView = document.getElementById('leaderboard-view'),
                  leaderboardMenuBtn = document.getElementById('leaderboard-menu-btn'),
                  backToDashboardFromLeaderboardBtn = document.getElementById('back-to-dashboard-from-leaderboard-btn'),
                  leaderboardList = document.getElementById('leaderboard-list');


            let displayedDate = getLocalDateString(new Date());
            let calendarDate = new Date();
            let chartDate = new Date();

            // --- FUNGSI ---
            function getLocalDateString(date) { const offset = date.getTimezoneOffset(); return new Date(date.getTime() - (offset * 60 * 1000)).toISOString().split('T')[0]; }

            function createAmalItem(item) {
                return `<div class="bg-emerald-50/70 dark:bg-gray-700/50 rounded-lg p-3"><input type="checkbox" id="${item.id}-${displayedDate}" class="hidden custom-checkbox" data-id="${item.id}"><label for="${item.id}-${displayedDate}" class="flex items-center cursor-pointer"><div class="w-6 h-6 mr-3 border-2 border-emerald-200 dark:border-gray-600 rounded-md flex items-center justify-center transition-all duration-200"><svg class="w-4 h-4 text-white hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg></div><span class="text-base font-medium">${item.text}</span></label></div>`;
            }
            
            function updateDateDisplay(dateString) {
                const date = new Date(dateString);
                const userTimezoneOffset = date.getTimezoneOffset() * 60000;
                const adjustedDate = new Date(date.getTime() + userTimezoneOffset);

                dayNameDisplay.textContent = adjustedDate.toLocaleDateString('id-ID', { weekday: 'long' });
                dateDisplay.textContent = adjustedDate.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            }

            function updateScore() { let totalScore = 0; document.querySelectorAll('.custom-checkbox:checked').forEach(cb => { totalScore += allAmalMap.get(cb.dataset.id)?.points || 0; }); scoreText.textContent = totalScore; }

            function submitAmalan() {
                const history = JSON.parse(localStorage.getItem('amalYaumiHistory')) || {};
                const checkedState = {};
                let currentScore = 0, wajibCompletedCount = 0;
                
                document.querySelectorAll('.custom-checkbox').forEach(cb => {
                    checkedState[cb.dataset.id] = cb.checked;
                    if(cb.checked) {
                        const amalItem = allAmalMap.get(cb.dataset.id);
                        currentScore += amalItem?.points || 0;
                        if (amalan.wajib.some(w => w.id === amalItem.id)) { wajibCompletedCount++; }
                    }
                });
                history[displayedDate] = { state: checkedState, score: currentScore, wajibCompleted: wajibCompletedCount };
                localStorage.setItem('amalYaumiHistory', JSON.stringify(history));
                populateHistoryList();
                showSubmittedView(wajibCompletedCount);
            }

            function loadStateForDate(date) {
                displayedDate = date;
                updateDateDisplay(date);
                renderChecklist();
                
                const history = JSON.parse(localStorage.getItem('amalYaumiHistory')) || {};
                const savedData = history[date];

                if (savedData) {
                    Object.keys(savedData.state).forEach(id => {
                        const cb = document.querySelector(`.custom-checkbox[data-id="${id}"]`);
                        if(cb) cb.checked = savedData.state[id];
                    });
                    showSubmittedView(savedData.wajibCompleted);
                } else { showMainView(); }
                updateScore();
            }
            
            function deleteCurrentDayData() {
                const history = JSON.parse(localStorage.getItem('amalYaumiHistory')) || {};
                if (history[displayedDate]) {
                    delete history[displayedDate];
                    localStorage.setItem('amalYaumiHistory', JSON.stringify(history));
                    loadStateForDate(displayedDate);
                    populateHistoryList();
                }
                toggleConfirmationModal();
            }

            function updateFeedbackView(count) {
                let bgColorClasses = '', contentHTML = '';
                switch (count) {
                    case 5: bgColorClasses = 'bg-emerald-100 dark:bg-emerald-900/50'; contentHTML = `<h2 class="text-2xl font-bold text-emerald-800 dark:text-emerald-300">Masya Allah, Sempurna! 😊</h2><p class="mt-2 text-emerald-700 dark:text-emerald-200">Semoga Allah menerima setiap sujud dan doamu hari ini.</p>`; break;
                    case 4: bgColorClasses = 'bg-yellow-100 dark:bg-yellow-900/50'; contentHTML = `<h2 class="text-2xl font-bold text-yellow-800 dark:text-yellow-300">Hampir Sempurna!</h2><p class="mt-2 text-yellow-700 dark:text-yellow-200">Konsisten ibadah itu memang sulit, tapi jangan buat itu menjadi alasan untuk meninggalkan yang wajib.</p>`; break;
                    case 3: bgColorClasses = 'bg-amber-100 dark:bg-amber-800/60'; contentHTML = `<h2 class="text-2xl font-bold text-amber-800 dark:text-amber-300">Alhamdulillah</h2><p class="mt-2 text-amber-700 dark:text-amber-200">3/5 kewajiban tuntas. Sedikit lagi! Coba pasang alarm untuk sholat berikutnya agar tidak terlewat.</p>`; break;
                    case 2: bgColorClasses = 'bg-red-100 dark:bg-red-900/40'; contentHTML = `<h2 class="text-2xl font-bold text-red-800 dark:text-red-300">Yuk, Semangat Lagi!</h2><p class="mt-2 text-red-700 dark:text-red-200">Setiap langkah dihitung. Tips: Coba kerjakan sholat begitu adzan terdengar, jangan menunda.</p>`; break;
                    case 1: bgColorClasses = 'bg-red-200 dark:bg-red-800/60'; contentHTML = `<h2 class="text-2xl font-bold text-red-800 dark:text-red-300">Jangan Terlena... 😔</h2><p class="mt-2 text-red-700 dark:text-red-200">"Sebegitu nikmatnya dunia sampai kita terlena terhadapnya."<br><span class="text-xs">Tips: Niatkan sholat berikutnya sebagai prioritas utamamu.</span></p>`; break;
                    default: bgColorClasses = 'bg-gray-200 dark:bg-gray-700/50'; contentHTML = `<h2 class="text-2xl font-bold text-gray-800 dark:text-gray-300">Jangan Menyerah 😔</h2><p class="mt-2 text-gray-700 dark:text-gray-200">Hari ini mungkin berat, tapi pintu taubat selalu terbuka. Mari kita niatkan untuk lebih baik esok hari.</p>`; break;
                }
                feedbackPanel.className = `p-6 rounded-xl transition-colors duration-500 shadow-lg ${bgColorClasses}`;
                feedbackPanel.innerHTML = contentHTML;
            }
            
            function showMainView() { mainView.classList.remove('hidden'); submittedView.classList.add('hidden'); }

            function showSubmittedView(wajibCompletedCount) {
                mainView.classList.add('hidden');
                submittedView.classList.remove('hidden');
                updateFeedbackView(wajibCompletedCount);
                quoteContainer.textContent = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`;
                calculateAndDisplayMonthlyActivity();
            }

            function getMonthlyStats(date){
                const history = JSON.parse(localStorage.getItem('amalYaumiHistory')) || {};
                const currentMonth = date.toISOString().substring(0, 7);
                let totalPoints = 0, activeDays = 0;
                const amalCount = {};
                Object.keys(history).forEach(d => {
                    if (d.startsWith(currentMonth)) {
                        activeDays++;
                        totalPoints += history[d].score;
                        Object.keys(history[d].state).forEach(amalId => {
                            if (history[d].state[amalId]) { amalCount[amalId] = (amalCount[amalId] || 0) + 1; }
                        });
                    }
                });
                return { totalPoints, activeDays, amalCount };
            }

            function getAllTimeStats(){
                const history = JSON.parse(localStorage.getItem('amalYaumiHistory')) || {};
                let totalPoints = 0;
                const amalCount = {};
                Object.values(history).forEach(dayData => {
                    totalPoints += dayData.score;
                    Object.keys(dayData.state).forEach(amalId => {
                        if (dayData.state[amalId]) { amalCount[amalId] = (amalCount[amalId] || 0) + 1; }
                    });
                });
                return { totalPoints, amalCount };
            }
            
            function calculateAndDisplayMonthlyActivity() {
                const { totalPoints, activeDays, amalCount } = getMonthlyStats(new Date(displayedDate));
                let topAmalText = 'Belum ada amalan bulan ini.';
                if(Object.keys(amalCount).length > 0) {
                    const topAmalId = Object.keys(amalCount).reduce((a, b) => amalCount[a] > amalCount[b] ? a : b);
                    topAmalText = `<b>${allAmalMap.get(topAmalId).text}</b> (${amalCount[topAmalId]} kali)`;
                }
                monthlyActivityContainer.innerHTML = `<h3 class="font-semibold text-lg mb-2 text-center">Ringkasan Aktivitas Bulan Ini</h3><div class="space-y-3 bg-white dark:bg-gray-800/70 p-4 rounded-lg shadow-lg"><div class="flex justify-between"><span>Total Poin:</span> <span class="font-bold text-emerald-600">${totalPoints}</span></div><div class="flex justify-between"><span>Hari Aktif:</span> <span class="font-bold">${activeDays}</span></div><div class="flex justify-between"><span>Amalan Teratas:</span> <span class="font-bold">${topAmalText}</span></div></div>`;
            }

            function getCubeColors(percentage) {
                if (percentage >= 100) { return { front: '#16a34a', top: '#22c55e', side: '#15803d', text: 'text-green-600' }; } 
                else if (percentage >= 75) { return { front: '#84cc16', top: '#a3e635', side: '#65a30d', text: 'text-lime-500' }; } 
                else if (percentage >= 50) { return { front: '#f59e0b', top: '#facc15', side: '#d97706', text: 'text-amber-500' }; } 
                else if (percentage >= 25) { return { front: '#ef4444', top: '#f87171', side: '#dc2626', text: 'text-red-500' }; } 
                else { return { front: '#991b1b', top: '#b91c1c', side: '#7f1d1d', text: 'text-red-800' }; }
            }
            
            function populateStandaloneMonthlyChart() {
                monthYearChartDisplay.textContent = chartDate.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
                const { activeDays, amalCount } = getMonthlyStats(chartDate);
                let chartHTML = '';
                
                if (activeDays === 0) {
                    chartHTML += `<p class="text-sm text-center">Belum ada data untuk ditampilkan.</p>`;
                    monthlyChartStandaloneContainer.innerHTML = chartHTML; return;
                }

                function createChartSection(title, amalList) {
                    let sectionHTML = `<h4 class="font-semibold text-md mb-2">${title}</h4><div class="chart-grid bg-white dark:bg-gray-800/70 rounded-lg shadow-lg">`;
                    amalList.forEach(amal => {
                        const count = amalCount[amal.id] || 0;
                        const percentage = Math.round((count / activeDays) * 100);
                        const colors = getCubeColors(percentage);
                        sectionHTML += `<div class="cube-wrapper">
                                            <div class="cube-percentage ${colors.text} dark:${colors.text}">${percentage}%</div>
                                            <div class="cube" style="height: ${percentage * 1.2}px">
                                                <div class="cube-face front" style="background-color: ${colors.front};"></div>
                                                <div class="cube-face top" style="background-color: ${colors.top};"></div>
                                                <div class="cube-face side" style="background-color: ${colors.side};"></div>
                                            </div>
                                            <div class="cube-label">${amal.text}</div>
                                        </div>`;
                    });
                    sectionHTML += `</div>`;
                    return sectionHTML;
                }
                chartHTML += createChartSection('Ibadah Wajib', amalan.wajib);
                chartHTML += `<div class="mt-6">${createChartSection('Ibadah Sunnah', amalan.sunnah)}</div>`;
                monthlyChartStandaloneContainer.innerHTML = chartHTML;
            }

            function populateAchievements() {
                achievementList.innerHTML = '';
                const { totalPoints, amalCount } = getAllTimeStats();

                achievements.forEach(ach => {
                    let isUnlocked = false;
                    let progressText = '';

                    if (ach.type === 'count') {
                        const count = amalCount[ach.amalId] || 0;
                        isUnlocked = count >= ach.threshold;
                        progressText = `Terkunci (${count}/${ach.threshold})`;
                    } else if (ach.type === 'score') {
                        isUnlocked = totalPoints > ach.threshold;
                        progressText = `Terkunci (Poin: ${totalPoints}/${ach.threshold + 1})`;
                    }

                    const cardClass = isUnlocked ? 'unlocked' : 'locked';
                    const iconBg = isUnlocked ? 'bg-amber-300 dark:bg-amber-400' : 'bg-gray-200 dark:bg-gray-700';
                    const iconColor = isUnlocked ? 'text-amber-700 dark:text-amber-900' : 'text-gray-500';
                    
                    achievementList.innerHTML += `
                        <div class="achievement-card ${cardClass} bg-white dark:bg-gray-800/70 p-4 rounded-lg shadow-lg flex items-center space-x-4">
                            <div class="achievement-icon ${iconBg} p-3 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 ${iconColor}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 20.944A12.02 12.02 0 0012 21a12.02 12.02 0 009-10.056c0-1.307-.21-2.57-.618-3.784z" />
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg">${ach.title}</h4>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${ach.description}</p>
                                <p class="text-xs font-semibold mt-1 ${isUnlocked ? 'text-green-600' : 'text-red-600'}">${isUnlocked ? 'Terbuka!' : progressText}</p>
                            </div>
                        </div>`;
                });
            }
            
            function populateLeaderboard() {
                leaderboardList.innerHTML = '';
                const { totalPoints } = getAllTimeStats();
                const currentUser = { name: 'Anda', score: totalPoints, isCurrentUser: true };
                
                const leaderboardData = [...mockUsers, currentUser].sort((a,b) => b.score - a.score);
                
                leaderboardData.forEach((user, index) => {
                    const rank = index + 1;
                    const highlightClass = user.isCurrentUser ? 'bg-emerald-100 dark:bg-emerald-900/50 border-2 border-emerald-500' : 'bg-white dark:bg-gray-800/70';
                    leaderboardList.innerHTML += `
                        <li class="${highlightClass} p-3 rounded-lg shadow flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="font-bold text-lg w-8">${rank}</span>
                                <div>
                                    <p class="font-semibold">${user.name}</p>
                                </div>
                            </div>
                            <span class="font-bold text-emerald-600 dark:text-emerald-400">${user.score} Poin</span>
                        </li>
                    `;
                });
            }

            function renderChecklist() {
                 wajibList.innerHTML = ''; sunnahList.innerHTML = '';
                 amalan.wajib.forEach(item => wajibList.innerHTML += createAmalItem(item));
                 amalan.sunnah.forEach(item => sunnahList.innerHTML += createAmalItem(item));
                 document.querySelectorAll('.custom-checkbox').forEach(cb => cb.addEventListener('change', updateScore));
            }

            function populateHistoryList() {
                historyList.innerHTML = '';
                const history = JSON.parse(localStorage.getItem('amalYaumiHistory')) || {};
                const sortedDates = Object.keys(history).sort((a, b) => new Date(b) - new Date(a));
                if (sortedDates.length === 0) { historyList.innerHTML = `<li class="p-2 text-sm text-gray-500">Belum ada riwayat.</li>`; return; }
                sortedDates.forEach(date => {
                    const item = document.createElement('li');
                    item.innerHTML = `<a href="#" data-date="${date}" class="block p-2 rounded-lg hover:bg-stone-200/50 dark:hover:bg-gray-700/50"><p class="text-sm font-semibold">${new Date(date).toLocaleDateString('id-ID', {timeZone: 'UTC', day:'numeric', month:'long', year:'numeric'})}</p><p class="text-xs text-emerald-600">${history[date].score} Poin</p></a>`;
                    historyList.appendChild(item);
                });
            }
            
             function generateCalendar() {
                const year = calendarDate.getFullYear();
                const month = calendarDate.getMonth();
                monthYearDisplay.textContent = new Date(year, month).toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
                calendarBody.innerHTML = '';
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const history = JSON.parse(localStorage.getItem('amalYaumiHistory')) || {};

                for (let i = 0; i < firstDay; i++) {
                    calendarBody.innerHTML += `<div></div>`;
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dateStr = getLocalDateString(new Date(year, month, i));
                    let isCompleted = '';
                    let checkmarkColorClass = 'text-gray-500';

                    if (history[dateStr]) {
                        isCompleted = 'completed';
                        const count = history[dateStr].wajibCompleted;
                        switch (count) {
                            case 5: checkmarkColorClass = 'text-emerald-500'; break;
                            case 4: checkmarkColorClass = 'text-yellow-400'; break;
                            case 3: checkmarkColorClass = 'text-amber-500'; break;
                            case 2: checkmarkColorClass = 'text-red-400'; break;
                            case 1: checkmarkColorClass = 'text-red-600'; break;
                            default: if (history[dateStr].score > 0) {checkmarkColorClass = 'text-gray-500';} else {isCompleted = '';} break;
                        }
                    }
                    
                    const isToday = dateStr === getLocalDateString(new Date()) ? 'bg-emerald-200/50 dark:bg-emerald-800/50 rounded-full' : '';
                    
                    calendarBody.innerHTML += `
                        <div class="calendar-day ${isCompleted} cursor-pointer hover:font-bold" data-date="${dateStr}">
                            <span class="${isToday} w-8 h-8 flex items-center justify-center">${i}</span>
                            <div class="check-icon w-4 h-4 ${checkmarkColorClass}">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                            </div>
                        </div>`;
                }
                 document.querySelectorAll('.calendar-day').forEach(day => {
                    day.addEventListener('click', (e) => {
                        const date = e.currentTarget.dataset.date;
                        if(date) {
                            loadStateForDate(date);
                            showView(dashboardView);
                        }
                    });
                });
            }

            function toggleSidebar() { sidebar.classList.toggle('sidebar-open'); overlay.classList.toggle('hidden'); }
            
            function toggleConfirmationModal() {
                if (confirmationModal.classList.contains('hidden')) {
                    confirmationModal.classList.remove('hidden');
                    setTimeout(() => confirmationModal.classList.remove('opacity-0'), 10);
                } else {
                    confirmationModal.classList.add('opacity-0');
                    setTimeout(() => confirmationModal.classList.add('hidden'), 200);
                }
            }
            
            function returnToWelcome() {
                appContainer.classList.add('hidden');
                welcomeView.style.opacity = '1';
                welcomeView.classList.remove('hidden');
                toggleSidebar();
            }
            
            function showView(viewToShow) {
                [dashboardView, calendarView, chartView, achievementView, leaderboardView].forEach(view => view.classList.add('hidden'));
                viewToShow.classList.remove('hidden');
                toggleSidebar();
            }

            function initialize() {
                // Welcome Screen Logic
                if (localStorage.getItem('hasVisitedAmalYaumi')) {
                    welcomeView.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                }
                enterAppBtn.addEventListener('click', () => {
                    localStorage.setItem('hasVisitedAmalYaumi', 'true');
                    welcomeView.style.transition = 'opacity 0.5s ease-in-out';
                    welcomeView.style.opacity = '0';
                    setTimeout(() => {
                        welcomeView.classList.add('hidden');
                        appContainer.classList.remove('hidden');
                        appContainer.classList.add('fade-in');
                    }, 500);
                });
                
                // App Logic
                prevDayBtn.addEventListener('click', () => {
                    const currentDate = new Date(displayedDate);
                    currentDate.setDate(currentDate.getDate() - 1);
                    loadStateForDate(getLocalDateString(currentDate));
                });
                 nextDayBtn.addEventListener('click', () => {
                    const currentDate = new Date(displayedDate);
                    currentDate.setDate(currentDate.getDate() + 1);
                    loadStateForDate(getLocalDateString(currentDate));
                });

                submitBtn.addEventListener('click', submitAmalan);
                backToBtn.addEventListener('click', showMainView);
                deleteDayBtn.addEventListener('click', toggleConfirmationModal);
                cancelDeleteBtn.addEventListener('click', toggleConfirmationModal);
                confirmDeleteBtn.addEventListener('click', deleteCurrentDayData);
                backToWelcomeBtn.addEventListener('click', returnToWelcome);
                
                monthlyActivityBtn.addEventListener('click', () => showView(calendarView));
                monthlyChartMenuBtn.addEventListener('click', () => { populateStandaloneMonthlyChart(); showView(chartView); });
                achievementMenuBtn.addEventListener('click', () => { populateAchievements(); showView(achievementView); });
                leaderboardMenuBtn.addEventListener('click', () => { populateLeaderboard(); showView(leaderboardView); });

                [backToDashboardBtn, backToDashboardFromChartBtn, backToDashboardFromAchievementBtn, backToDashboardFromLeaderboardBtn].forEach(btn => {
                    btn.addEventListener('click', () => showView(dashboardView));
                });
                
                prevMonthBtn.addEventListener('click', () => { calendarDate.setMonth(calendarDate.getMonth() - 1); generateCalendar(); });
                nextMonthBtn.addEventListener('click', () => { calendarDate.setMonth(calendarDate.getMonth() + 1); generateCalendar(); });
                prevMonthChartBtn.addEventListener('click', () => { chartDate.setMonth(chartDate.getMonth() - 1); populateStandaloneMonthlyChart(); });
                nextMonthChartBtn.addEventListener('click', () => { chartDate.setMonth(chartDate.getMonth() + 1); populateStandaloneMonthlyChart(); });

                loadStateForDate(displayedDate);
                populateHistoryList();
                openSidebarBtn.addEventListener('click', toggleSidebar);
                closeSidebarBtn.addEventListener('click', toggleSidebar);
                overlay.addEventListener('click', toggleSidebar);
                historyList.addEventListener('click', (e) => {
                    e.preventDefault();
                    const link = e.target.closest('a');
                    if (link && link.dataset.date) { loadStateForDate(link.dataset.date); toggleSidebar(); }
                });
            }

            initialize();
        });
    </script>
</body>
</html>
